<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AI ç¥ç§˜å¡”ç½—é¦†</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        /* ç®€å•å†™ç‚¹æ ·å¼ï¼Œè®©å®ƒçœ‹èµ·æ¥åƒé‚£ä¹ˆå›äº‹ */
        body { background: #1a1a2a; color: #e0e0e0; font-family: sans-serif; display: flex; justify-content: center; min-height: 100vh; align-items: center; }
        .card-room { background: #2a2a3a; padding: 2rem; border-radius: 15px; box-shadow: 0 0 20px rgba(138, 43, 226, 0.3); width: 400px; text-align: center; }
        input { width: 80%; padding: 10px; margin: 10px 0; border-radius: 5px; border: 1px solid #444; background: #333; color: white; }
        button { background: linear-gradient(45deg, #8a2be2, #4b0082); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: transform 0.2s;}
        button:hover { transform: scale(1.05); }
        button:disabled { background: #555; cursor: not-allowed; }
        .result-box { margin-top: 20px; text-align: left; background: #222; padding: 15px; border-radius: 8px; border-left: 4px solid #8a2be2; line-height: 1.6; }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.5s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body>

<div id="app">
    <div class="card-room">
        <h2>ğŸ”® AI å¡”ç½—æŒ‡å¼•</h2>

        <div v-if="!result">
            <p>å¿ƒä¸­é»˜å¿µä½ çš„é—®é¢˜</p>
            <input v-model="question" placeholder="ä¾‹å¦‚ï¼šæˆ‘åº”è¯¥è¾èŒå»æ—¥æœ¬å—ï¼Ÿ">
            <br>
            <button @click="startDivination" :disabled="loading || !question">
                {{ loading ? 'æ­£åœ¨æ„Ÿåº”ç‰Œæ„...' : 'æŠ½å–ç‰Œé¢å¹¶è§£è¯»' }}
            </button>
        </div>

        <div v-else class="result-box">
            <h3 style="color: #d8bfd8">ğŸ´ æŠ½åˆ°çš„ç‰Œï¼š{{ pickedCard }}</h3>
            <p>{{ result }}</p>
            <button @click="reset" style="margin-top:15px; background: #444; font-size: 0.8em">å†æµ‹ä¸€æ¬¡</button>
        </div>
    </div>
</div>

<script>
    const { createApp, ref } = Vue;

    createApp({
        setup() {
            const question = ref('');
            const result = ref('');
            const loading = ref(false);
            const pickedCard = ref('');

            // ç®€å•çš„ç‰Œåº“
            const tarotCards = ['æ„šäºº', 'é­”æœ¯å¸ˆ', 'å¥³ç¥­å¸', 'å¥³çš‡', 'çš‡å¸', 'æ•™çš‡', 'æ‹äºº', 'æˆ˜è½¦', 'éšå£«', 'å‘½è¿ä¹‹è½®', 'æ­£ä¹‰', 'å€’åŠäºº', 'æ­»ç¥', 'èŠ‚åˆ¶', 'æ¶é­”', 'å¡”', 'æ˜Ÿæ˜Ÿ', 'æœˆäº®', 'å¤ªé˜³', 'å®¡åˆ¤', 'ä¸–ç•Œ'];

            const startDivination = async () => {
                if (!question.value) return;
                loading.value = true;

                // 1. å‰ç«¯æ¨¡æ‹ŸæŠ½ç‰Œ
                pickedCard.value = tarotCards[Math.floor(Math.random() * tarotCards.length)];

                // 2. è¯·æ±‚åç«¯
                try {
                    const res = await fetch('/api/divine', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            question: question.value,
                            card: pickedCard.value
                        })
                    });
                    const data = await res.json();
                    if(data.success) {
                        result.value = data.data;
                    }
                } catch (e) {
                    alert('ç½‘ç»œè¿æ¥å¤±è´¥');
                } finally {
                    loading.value = false;
                }
            };

            const reset = () => {
                result.value = '';
                question.value = '';
                pickedCard.value = '';
            }

            return { question, result, loading, pickedCard, startDivination, reset };
        }
    }).mount('#app');
</script>
</body>
</html>