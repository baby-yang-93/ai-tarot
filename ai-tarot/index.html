<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ç¥ç§˜å¡”ç½—é¦†</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        /* --- åŸºç¡€å¸ƒå±€ --- */
        body {
            background: radial-gradient(circle at center, #1a0b2e 0%, #000000 100%);
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            align-items: center;
            margin: 0;
        }

        .main-container {
            width: 90%;
            max-width: 400px;
            text-align: center;
            padding-bottom: 50px;
        }

        h2 {
            font-weight: 300;
            letter-spacing: 2px;
            margin-bottom: 30px;
            color: #d8bfd8;
            text-shadow: 0 0 10px rgba(216, 191, 216, 0.5);
        }

        /* --- è¾“å…¥æ¡†ä¸æŒ‰é’® --- */
        .input-group {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.5s ease;
        }

        input {
            width: 100%;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 10px;
            border: 1px solid #444;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            box-sizing: border-box; /* ä¿®å¤å®½åº¦æº¢å‡º */
            font-size: 16px;
            outline: none;
        }

        input:focus { border-color: #8a2be2; }

        .magic-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(118, 75, 162, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .magic-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(118, 75, 162, 0.6); }
        .magic-btn:disabled { background: #555; cursor: not-allowed; transform: none; box-shadow: none; }

        /* --- 3D å¡ç‰Œæ ¸å¿ƒæ ·å¼ (æŠ„è¿™é‡Œï¼) --- */
        .scene {
            width: 200px;
            height: 340px;
            margin: 0 auto 30px;
            perspective: 1000px; /* 3Dé€è§† */
        }

        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transition: transform 1s;
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .card.is-flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden; /* èƒŒé¢ä¸å¯è§ */
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* ç‰ŒèƒŒï¼šç”¨CSSç”»ä¸€ä¸ªç¥ç§˜å›¾æ¡ˆ */
        .card-back {
            background: #1a1a1a;
            background-image: radial-gradient(#2a2a2a 15%, transparent 16%), radial-gradient(#2a2a2a 15%, transparent 16%);
            background-size: 20px 20px;
            border: 2px solid #4b0082;
        }
        .card-back::after {
            content: 'ğŸ”®';
            font-size: 50px;
            filter: drop-shadow(0 0 10px #8a2be2);
            animation: pulse 2s infinite;
        }

        /* ç‰Œé¢ï¼šç»“æœé¡µ */
        .card-front {
            background: linear-gradient(to bottom right, #fdfbfb, #ebedee);
            color: #333;
            transform: rotateY(180deg); /* åˆå§‹çŠ¶æ€æ˜¯åç€çš„ */
            border: 5px solid #d4af37; /* é‡‘è¾¹ */
        }

        .card-title {
            font-size: 24px;
            font-weight: bold;
            color: #1a0b2e;
            margin-top: 10px;
        }

        .card-image-placeholder {
            font-size: 80px;
            margin: 20px 0;
        }

        /* --- è§£è¯»ç»“æœåŒºåŸŸ --- */
        .result-area {
            text-align: left;
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 10px;
            border-top: 2px solid #8a2be2;
            animation: fadeIn 1s ease-in;
        }

        /* --- åŠ¨ç”»å…³é”®å¸§ --- */
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 0.8; }
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .fade-enter-active, .fade-leave-active { transition: opacity 0.5s; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body>

<div id="app">
    <div class="main-container">
        <h2>ğŸ”® AI å¡”ç½—æŒ‡å¼•</h2>

        <transition name="fade" mode="out-in">
            <div v-if="step === 'input'" class="input-group" key="input">
                <input v-model="question" placeholder="é»˜å¿µä½ çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼šæˆ‘è¿‘æœŸè´¢è¿å¦‚ä½•ï¼Ÿ" @keyup.enter="startDivination">
                <button class="magic-btn" @click="startDivination" :disabled="!question">
                    å¼€å§‹æ„Ÿåº”
                </button>
            </div>

            <div v-else key="reading">
                <div class="scene">
                    <div class="card" :class="{ 'is-flipped': isFlipped }">
                        <div class="card-face card-back"></div>
                        <div class="card-face card-front">
                            <div class="card-image-placeholder">ğŸ´</div>
                            <div class="card-title">{{ pickedCard }}</div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px">æ­£ä½</div>
                        </div>
                    </div>
                </div>

                <p v-if="loading" style="color: #bbb; font-style: italic; animation: pulse 1.5s infinite">
                    æ­£åœ¨è¿æ¥å®‡å®™èƒ½é‡...
                </p>

                <div v-if="result" class="result-area">
                    <p style="line-height: 1.8; font-size: 15px;">{{ result }}</p>
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="magic-btn" @click="reset" style="padding: 8px 20px; font-size: 14px; background: #444;">
                            å†æµ‹ä¸€æ¬¡
                        </button>
                    </div>
                </div>
            </div>
        </transition>
    </div>
</div>

<script>
    const { createApp, ref } = Vue;

    createApp({
        setup() {
            const step = ref('input'); // input | reading
            const question = ref('');
            const result = ref('');
            const loading = ref(false);
            const pickedCard = ref('');
            const isFlipped = ref(false);

            const tarotCards = ['æ„šäºº', 'é­”æœ¯å¸ˆ', 'å¥³ç¥­å¸', 'å¥³çš‡', 'çš‡å¸', 'æ•™çš‡', 'æ‹äºº', 'æˆ˜è½¦', 'éšå£«', 'å‘½è¿ä¹‹è½®', 'æ­£ä¹‰', 'å€’åŠäºº', 'æ­»ç¥', 'èŠ‚åˆ¶', 'æ¶é­”', 'å¡”', 'æ˜Ÿæ˜Ÿ', 'æœˆäº®', 'å¤ªé˜³', 'å®¡åˆ¤', 'ä¸–ç•Œ'];

            const startDivination = async () => {
                if (!question.value) return;

                // 1. åˆ‡æ¢ç•Œé¢çŠ¶æ€
                step.value = 'reading';
                loading.value = true;
                isFlipped.value = false; // ç¡®ä¿æ˜¯ç‰ŒèƒŒæœä¸Š

                // 2. é€‰ç‰Œ
                pickedCard.value = tarotCards[Math.floor(Math.random() * tarotCards.length)];

                try {
                    // 3. è¯·æ±‚API
                    const res = await fetch('/api/index', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            question: question.value,
                            card: pickedCard.value
                        })
                    });
                    const data = await res.json();

                    if(data.success) {
                        result.value = data.data;

                        // 4. å…³é”®ï¼šå»¶è¿Ÿä¸€ç‚¹å†ç¿»ç‰Œï¼Œå¢åŠ ä»ªå¼æ„Ÿ
                        setTimeout(() => {
                            loading.value = false;
                            isFlipped.value = true; // ç¿»ç‰Œï¼
                        }, 500);
                    }
                } catch (e) {
                    alert('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·ç¨åå†è¯•');
                    step.value = 'input'; // å›é€€
                }
            };

            const reset = () => {
                step.value = 'input';
                result.value = '';
                question.value = '';
                pickedCard.value = '';
                isFlipped.value = false;
            }

            return { step, question, result, loading, pickedCard, isFlipped, startDivination, reset };
        }
    }).mount('#app');
</script>
</body>
</html>